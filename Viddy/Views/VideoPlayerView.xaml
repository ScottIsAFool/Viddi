<local:BasePage x:Class="Viddy.Views.VideoPlayerView"
                xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                xmlns:local="using:Viddy.Views"
                xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
                xmlns:core="using:Microsoft.Xaml.Interactions.Core"
                xmlns:controls="using:Viddy.Controls"
                xmlns:playerFramework="using:Microsoft.PlayerFramework"
                xmlns:converters="using:Cimbalino.Toolkit.Converters"
                mc:Ignorable="d"
                Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
                DataContext="{Binding VideoPlayer, Source={StaticResource Locator}}">
    <interactivity:Interaction.Behaviors>
        <core:EventTriggerBehavior EventName="Loaded">
            <core:InvokeCommandAction Command="{Binding PageLoadedCommand}" />
        </core:EventTriggerBehavior>
    </interactivity:Interaction.Behaviors>
    
    <local:BasePage.Resources>
        <converters:BooleanToStringConverter x:Key="LikeTextConverter"
                                             TrueValue="unlike"
                                             FalseValue="like"/>
        <converters:BooleanToStringConverter x:Key="LikeIconConverter"
                                             TrueValue="/Assets/Icons/appbar.thumbs.up.inverted.png"
                                             FalseValue="/Assets/Icons/appbar.thumbs.up.png"/>
    </local:BasePage.Resources>
    
    <local:BasePage.BottomAppBar>
        <CommandBar Visibility="Collapsed">
            <CommandBar.PrimaryCommands>
                <AppBarButton Label="like">
                    <AppBarButton.Icon>
                        <BitmapIcon UriSource=""/>
                    </AppBarButton.Icon>
                </AppBarButton>
            </CommandBar.PrimaryCommands>
        </CommandBar>
    </local:BasePage.BottomAppBar>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <Grid Background="{ThemeResource HeaderBrush}"
              Height="80">
            <Grid Margin="19,0">
                <TextBlock VerticalAlignment="Center"
                           Style="{StaticResource BodyTextBlockStyle}"
                           Text="{Binding Video.Title}"
                           TextTrimming="CharacterEllipsis"
                           TextWrapping="NoWrap"/>
            </Grid>
        </Grid>
        <Grid Grid.Row="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            
            <Grid Grid.Row="0">
                <StackPanel Orientation="Horizontal"
                            Margin="19,6,19,12">
                    <TextBlock Text="Submitted by:"
                               Style="{StaticResource BodyTextBlockStyle}"
                               Foreground="{ThemeResource SubtleBrush}"/>
                    <controls:CustomButton Style="{StaticResource EmptyButtonStyle}"
                                           TapCommand="{Binding NavigateToUserCommand}"
                                           IsHitTestVisible="{Binding Video.IsAnonymous, Converter={StaticResource NegativeBooleanConverter}}">
                        <TextBlock Text="{Binding Video.SubmittedBy}"
                                   Style="{StaticResource BodyTextBlockStyle}"
                                   FontWeight="Bold"
                                   Margin="6,0"/>
                    </controls:CustomButton>
                    <TextBlock Text="{Binding Video.Date}"
                               Style="{StaticResource BodyTextBlockStyle}"
                               Foreground="{ThemeResource SubtleBrush}" />
                </StackPanel>
            </Grid>

            <Grid MaxHeight="200"
                  Grid.Row="1"
                  VerticalAlignment="Top">
                <Image Source="{Binding Video.Video.ThumbnailUrl}"
                       Stretch="UniformToFill"
                       VerticalAlignment="Center" />
                <playerFramework:MediaPlayer IsVolumeVisible="False"
                                             IsDurationVisible="False"
                                             IsTimeElapsedVisible="False"
                                             IsTimeRemainingVisible="False"
                                             IsTimelineVisible="False"
                                             IsPlayPauseVisible="True"
                                             MediaFailed="MediaPlayer_OnMediaFailed"
                                             IsFullScreenVisible="True"
                                             Source="{Binding Video.Video.CompleteUrl}"
                                             IsFullScreenChanged="MediaPlayer_OnIsFullScreenChanged"
                                             x:Name="MediaPlayer">
                    <interactivity:Interaction.Behaviors>
                        <!--<behaviours:VideoStreamBehaviour File="{Binding File}"
                                                             IsAutoPlay="True"
                                                             IsStart="{Binding Play}"
                                                             IsPause="{Binding Pause}"
                                                             IsPlaying="{Binding IsPlaying, Mode=TwoWay}" />-->
                    </interactivity:Interaction.Behaviors>
                </playerFramework:MediaPlayer>
            </Grid>

            <controls:InitialisingListView Grid.Row="2"
                                           ItemsSource="{Binding Video.Comments}"
                                           ItemTemplate="{StaticResource CommentTemplate}"
                                           Margin="0,12,0,0"
                                           IsEmpty="{Binding Video.IsEmpty}"
                                           IsInitialising="{Binding Video.ProgressIsVisible}">
                <controls:InitialisingListView.EmptyContent>
                    <DataTemplate>
                        <Grid>
                            <Grid.Resources>
                                <converters:BooleanToStringConverter x:Key="LeaveCommentConverter"
                                                                     TrueValue="No comments have been left for this video, why not leave one?"
                                                                     FalseValue="No comments have been left for this video, why not sign in and leave one?"/>
                            </Grid.Resources>
                            <TextBlock Text="{Binding Auth.IsLoggedIn, Source={StaticResource Locator}, Converter={StaticResource LeaveCommentConverter}}"
                                       TextWrapping="WrapWholeWords"
                                       TextAlignment="Center"
                                       Style="{StaticResource BodyTextBlockStyle}" 
                                       Margin="19,0"/>
                        </Grid>
                    </DataTemplate>
                </controls:InitialisingListView.EmptyContent>
            </controls:InitialisingListView>
        </Grid>
    </Grid>
</local:BasePage>
